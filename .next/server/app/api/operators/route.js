"use strict";(()=>{var e={};e.id=62,e.ids=[62],e.modules={8013:e=>{e.exports=require("mongodb")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},859:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{GET:()=>u,POST:()=>d});var a=r(9303),s=r(8716),n=r(670),i=r(7070),p=r(4184),l=r(1615);async function u(e){try{let t=(0,l.cookies)(),r=t.get("asan_user_role")?.value,o=t.get("asan_user_id")?.value;if("admin"!==r)return i.NextResponse.json({error:"Unauthorized access"},{status:403});let{searchParams:a}=new URL(e.url),s=parseInt(a.get("page")||"1"),n=parseInt(a.get("limit")||"10"),u=a.get("search")||"",d=a.get("status")||"",c=a.get("role")||"",m=(s-1)*n,g=(await p.Z).db(),x=g.collection("staff");await g.collection("auditLogs").insertOne({action:"operators_list_access",userId:o,userRole:r,filters:{search:u,status:d,role:c,page:s,limit:n},timestamp:new Date,ipAddress:e.headers.get("x-forwarded-for")||"unknown"});let f={role:"operator"};u&&(f.$or=[{name:{$regex:u,$options:"i"}},{email:{$regex:u,$options:"i"}},{operatorId:{$regex:u,$options:"i"}}]),d&&(f.status=d),c&&(f.operatorRole=c);let w=await x.countDocuments(f),h=(await x.find(f).sort({_id:-1}).skip(m).limit(n).toArray()).map(e=>({id:e._id.toString(),operatorId:e.operatorId,name:e.name,email:e.email,phone:e.phone,location:e.location,status:e.status||"active",role:e.operatorRole||"Operator",permissions:e.permissions||[],joinDate:e.joinDate||new Date().toISOString().split("T")[0],lastLogin:e.lastLogin||null}));return i.NextResponse.json({operators:h,pagination:{total:w,page:s,limit:n,totalPages:Math.ceil(w/n)}})}catch(e){return console.error("Fetch operators error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let t=(0,l.cookies)(),r=t.get("asan_user_role")?.value,o=t.get("asan_user_id")?.value;if("admin"!==r)return i.NextResponse.json({error:"Unauthorized access"},{status:403});let a=await e.json();for(let e of["name","email","operatorId","password"])if(!a[e])return i.NextResponse.json({error:`Missing required field: ${e}`},{status:400});let s=(await p.Z).db(),n=s.collection("staff");if(await n.findOne({$or:[{operatorId:a.operatorId},{email:a.email}]}))return i.NextResponse.json({error:"An operator with this ID or email already exists"},{status:409});let u={...a,role:"operator",status:a.status||"active",createdAt:new Date,lastLogin:null},d=await n.insertOne(u);return await s.collection("auditLogs").insertOne({action:"create_operator",performedBy:o,userRole:r,targetId:d.insertedId.toString(),details:{operatorId:a.operatorId,name:a.name,email:a.email},timestamp:new Date,ipAddress:e.headers.get("x-forwarded-for")||"unknown"}),i.NextResponse.json({message:"Operator created successfully",id:d.insertedId},{status:201})}catch(e){return console.error("Create operator error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/operators/route",pathname:"/api/operators",filename:"route",bundlePath:"app/api/operators/route"},resolvedPagePath:"C:\\Users\\NITISH SINGHA\\Desktop\\camera project\\cameraStartUp\\app\\api\\operators\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x}=c,f="/api/operators/route";function w(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,535],()=>r(859));module.exports=o})();