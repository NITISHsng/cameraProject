"use strict";(()=>{var e={};e.id=740,e.ids=[740],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2001:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{POST:()=>l});var n=t(9303),a=t(8716),s=t(670),i=t(7070),u=t(4184);let p=require("bcrypt");async function l(e){try{let{userType:r,userId:t,operatorId:o,password:n}=await e.json();if(!n)return i.NextResponse.json({error:"Password required"},{status:400});if("admin"!==r&&"operator"!==r)return i.NextResponse.json({error:"Invalid user type"},{status:400});if("admin"===r&&!t)return i.NextResponse.json({error:"Admin ID required"},{status:400});if("operator"===r&&!o)return i.NextResponse.json({error:"Operator ID required"},{status:400});if(!await (0,u.y)())return i.NextResponse.json({error:"DB connection error"},{status:500});let a=(await u.Z).db().collection("staff"),s="admin"===r?await a.findOne({userId:t,role:"admin"}):await a.findOne({operatorId:o,role:"operator"});if(!s)return i.NextResponse.json({error:"User not found"},{status:401});if("inactive"===s.status)return i.NextResponse.json({error:"Account inactive"},{status:403});if(!(s.password?.startsWith("$2")?await (0,p.compare)(n,s.password):s.password?.trim()===n.trim()))return i.NextResponse.json({error:"Invalid password"},{status:401});await a.updateOne({_id:s._id},{$set:{lastLogin:new Date}});let l=i.NextResponse.json({id:s._id.toString(),name:s.name,email:s.email,role:s.role,status:s.status||"active"});return l.cookies.set({name:"asan_user_id",value:s._id.toString(),httpOnly:!0,secure:!0,sameSite:"none",maxAge:604800,path:"/"}),l.cookies.set({name:"asan_user_role",value:s.role,httpOnly:!0,secure:!0,sameSite:"none",maxAge:604800,path:"/"}),l}catch(e){return console.error("Login error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/login/route",pathname:"/api/login",filename:"route",bundlePath:"app/api/login/route"},resolvedPagePath:"C:\\Users\\NITISH SINGHA\\Desktop\\camera project\\cameraStartUp\\app\\api\\login\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:g}=c,f="/api/login/route";function v(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},4184:(e,r,t)=>{let o,n;t.d(r,{Z:()=>u,y:()=>i});var a=t(8013);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable");let s=process.env.MONGODB_URI;async function i(){try{let e=await n;return await e.db().command({ping:1}),!0}catch(e){return console.error("MongoDB connection verification failed:",e),!1}}global._mongoClientPromise||(o=new a.MongoClient(s),global._mongoClientPromise=o.connect().catch(e=>{throw console.error("Failed to connect to MongoDB:",e),e}));let u=n=global._mongoClientPromise}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972],()=>t(2001));module.exports=o})();